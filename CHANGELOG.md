Change Log
==========
Version 4.0.20 *(2024-11-28)*
----------------------------
- 修复 评价对话可能会串对话的问题
- 优化 Android 10 以下的权限申请

Version 4.0.19 *(2024-11-12)*
----------------------------
- 修复 重复消息的广播会再次发送的问题

Version 4.0.18 *(2024-11-07)*
----------------------------
- 修复 排队状态，可能出现界面显示异常问题

Version 4.0.17 *(2024-10-28)*
----------------------------
- 修复 复制富文本消息，会将标签一起复制的问题
- 优化 处理询前表单的 fallback

Version 4.0.16 *(2024-10-10)*
----------------------------
- 修复 复制富文本消息，会将标签一起复制的问题
- 优化 处理询前表单的 fallback

Version 4.0.14、4.0.15 *(2024-08-17)*
----------------------------
- 优化 appcompat 1.5.1 -> 1.3.1
- 新增 切换语言接口
- 修复 客服消息可能会显示重复的问题

Version 4.0.12、4.0.13 *(2024-06-13)*
----------------------------
- 修复 从排队创建的对话，不会弹出评价弹出的问题
- 优化 判断对话的分配以及排队状态

Version 4.0.10、4.0.11 *(2024-05-09)*
----------------------------
- 新增 根据工作台配置，动态显示发图入口
- 修复 客服在线，可能会发送留言的问题
- 修复 客服撤回消息，可能还会显示的问题

Version 4.0.9 *(2024-02-20)*
----------------------------
- 新增 根据工作台配置，动态显示发图入口
- 修复 机器人客服，权限请求会提示发送太快的问题

Version 4.0.8 *(2024-01-24)*
----------------------------
- 优化 顾客信息更新逻辑
- 优化 拒绝相关权限后，下次申请权限也显示权限申请弹窗

Version 4.0.7 *(2023-12-14)*
----------------------------
- 修复 Android 14 无法使用相机的问题
- 修复 时间戳可能会重复的问题
- 新增 支持根据工作台开关，判断是否允许加载历史对话

Version 4.0.6 *(2023-12-08)*
----------------------------
- 新增 子渠道配置支持

Version 4.0.5 *(2023-11-17)*
----------------------------
- 优化 讯前表单显示窗口名称
- 优化 关闭留言的情况下，如果客服是机器人，就不跳转到留言界面
- 优化 评价开关通过服务器配置判断

Version 4.0.4 *(2023-11-07)*
----------------------------
- 新增 日语、泰语、越南语、葡萄牙语、西班牙语、俄语、韩语
- 优化 兼容 targetSdkVersion 34

Version 4.0.3 *(2023-08-29)*
----------------------------
- 优化 从相册发送视频的时候，先显示权限弹窗

Version 4.0.2 *(2023-08-08)*
----------------------------
- 修复 机器人关联消息样式问题
- 修复 机器人手动转人工消息没有显示消息内容的问题
- 修复 在部分场景下，socket 断开连接没有自动重连的问题

Version 4.0.1 *(2023-07-12)*
----------------------------
- 优化 依赖项和混淆设置

Version 4.0.0 *(2023-07-11)*
----------------------------
- 优化 升级到 androidx

Version 3.9.10 *(2023-03-27)*
----------------------------
- 修复 发送视频消息失败的问题
- 新增 不显示客服撤回消息提示 功能支持
- 新增 讯前表单支持内容显示

Version 3.9.8、3.9.9 *(2023-02-14)*
----------------------------
- 修复 指定分配规则在留言状态时候丢失的问题
- 修复 排队结束，进入对话没有更新对话 id 的问题

Version 3.9.7 *(2023-01-20)*
----------------------------
- 修复 客服头像可能显示不准的问题

Version 3.9.6 *(2023-01-10)*
----------------------------
- 修复 无消息访客过滤状态，发送消息进入排队的时候，没有正确提示正在排队的问题

Version 3.9.5 *(2023-01-06)*
----------------------------
- 优化 机器人常见问题消息和相关问题消息的视觉样式

Version 3.9.2、3.9.3、3.9.4 *(2022-12-07)*
----------------------------
- 修复 留言消息可能重复显示的问题
- 优化 发送图片的时候，显示访问说明弹窗
- 优化 无消息访客过滤功能
- 新增 SDK 留言功能根据开关开启或关闭

Version 3.9.0、3.9.1 *(2022-11-02)*
----------------------------
- 修复 当商品卡片的 url 非 http 链接的情况下，无法响应链接回调接口的问题
- 修复 异常进入讯前表单界面导致错误的问题
- 优化 权限申请：Android 10 不再申请存储权限

Version 3.8.9 *(2022-08-01)*
----------------------------
- 优化 相机权限申请时机

Version 3.8.7、3.8.8 *(2022-07-20)*
----------------------------
- 优化 标题栏内容显示
- 修复 机器人头像可能显示不准确的问题

Version 3.8.6 *(2022-07-05)*
----------------------------
- 修复 富文本消息，如果图片带了超链接，点击图片无法跳转的问题
- 优化 记录讯前表单点击内容

Version 3.8.5 *(2022-06-24)*
----------------------------
- 新增 群发消息功能
- 优化 发送消息条件检测

Version 3.8.2、3.8.3、3.8.4 *(2022-06-16)*
----------------------------
- 修复 可能拉取不到工单消息的问题
- 优化 aar 中自动包含混淆配置，不需要开发者单独添加混淆规则
- 优化 评价布局显示

Version 3.8.0、3.8.1 *(2022-05-09)*
----------------------------
- 修复 处理机器人关键字转人工失败的情况
- 修复 点击表情键盘空白部分会闪退的问题
- 修复 部分设备评价弹窗中的评价按钮无法点击的问题
- 修复 超时结束对话，没有弹出自动评价的问题
- 优化 商品卡片图像加载

Version 3.7.9 *(2022-01-10)*
----------------------------
- 新增 支持营销机器人消息

Version 3.7.8 *(2021-12-20)*
----------------------------
- 修复 部分设备拍照发送图片无法显示的问题
- 新增 自定义配置

Version 3.7.7 *(2021-12-08)*
----------------------------
- 修复 部分设备拍照发送图片无法显示的问题

Version 3.7.6 *(2021-11-24)*
----------------------------
- 优化 处理部分系统超链接没有加 http 前缀导致无法跳转的问题
- 新增 快捷回复卡片支持 复制、拨打电话、跳转链接 的行为动作
- 新增 允许通过 16 进制颜色的方式来设 置标题栏背景 和 标题文字颜色

Version 3.7.5 *(2021-10-18)*
----------------------------
- 优化 当前进程名的判断逻辑

Version 3.7.2、3.7.4 *(2021-10-14)*
----------------------------
- 修复 点击留言按钮无法跳转留言界面的问题
- 修复 询前表单验证码无法加载的问题
- 优化 Android Q 以上系统，选择图片跳转到系统相册
- 优化 Android Q 以上系统，无法保存图片的问题
- 优化 配置刷新成功后才分配对话
- 优化 询前表单相关逻辑

Version 3.7.1 *(2021-09-13)*
----------------------------
- 修复 消息可能重复显示的问题

Version 3.6.9、3.7.0 *(2021-09-07)*
----------------------------
- 优化 聊天界面提示网络异常状态
- 新增 支持商品卡片消息显示
- 新增 发送商品卡片消息接口
- 新增 预发送商品卡片消息接口
- 新增 支持 马来语、印尼语、繁体
- 修复 Android Q 无法拍摄视频发送消息的问题

Version 3.6.8 *(2021-08-23)*
----------------------------
- 修复 修复留言文案过长会导致留言按钮消失的问题
- 修复 插入视频资源的时候，类型不对的问题
- 修复 排队状态结束后，没有发送预发送消息的问题
- 优化 允许从 socket 同步顾客消息
- 优化 排队等待状态显示
- 优化 表情键盘 emoji 显示
- 优化 分配对话后，列表只显示当前对话的消息

Version 3.6.7 *(2021-06-25)*
----------------------------
- 修复 部分应用无法点击评价按钮的问题
- 修复 图片预览可能出现空指针的问题
- 修复 Android 10 以上无法录制视频发送的问题
- 优化 对话分割样式
- 优化 录制视频质量
- 优化 请求权限之前弹出权限使用说明

Version 3.6.6 *(2021-03-25)*
----------------------------
- 修复 可能出现子线程 Toast 报错的问题
- 新增 消息回执功能

Version 3.6.5 *(2020-12-31)*
----------------------------
- 优化 工单留言界面
- 修复 发送视频没有检测相关权限的问题

Version 3.6.4 *(2020-11-25)*
----------------------------
- 修复 Android Q 无法保存图片到相册的问题
- 修复 无法打开文件消息文件的问题

Version 3.6.3 *(2020-11-13)*
----------------------------
- 修复 工单回复富文本消息，无法显示的问题
- 修复 线索卡片输入异常问题
- 修复 可能出现重复调用上线接口的问题
- 优化 无消息访客过滤消息，支持富文本显示
- 优化 分配成功后，才显示评价按钮
- 优化 支持显示机器人留言文本
- 优化 询前表单支持 Number 和 Date 类型字段
- 优化 对话列表，添加对话之间的分隔线
- 优化 图片压缩规则
- 新增 支持视频消息

Version 3.6.1、3.6.2 *(2020-05-12)*
----------------------------
- 新增 Hybrid 消息支持 text 类型
- 新增 支持客服消息撤回
- 新增 支持线索卡片消息
- 优化 排队文案与工作台同步
- 优化 富文本消息直接渲染出内容
- 修复 已知问题

Version 3.6.0 *(2019-12-10)*
----------------------------
- 优化 兼容 Android 10
- 优化 文件消息预览
- 修复 已知问题

Version 3.5.9 *(2019-10-31)*
----------------------------
- 新增 敏感词过滤功能
- 新增 顾客事件设置接口
- 优化 处理 Android 8.0 后台开启服务的异常
- 优化 socket 断开状态时候的消息获取逻辑

Version 3.5.8 *(2019-08-26)*
----------------------------
- 优化 GlideImageLoader4 加载错误，自动降级到 GlideImageLoader3

Version 3.5.7 *(2019-08-20)*
----------------------------
- 新增 支持红包卡片消息

Version 3.5.5、3.5.6 *(2019-08-08)*
----------------------------
- 优化 注册 token 接口注册流程，延迟到上线的时候注册
- 优化 兼容 glide4.x（如果项目使用的 glide3.x，请参考文档）
- 优化 提高连接访问的稳定性

Version 3.5.4 *(2019-06-24)*
----------------------------
- 修复 分配客服没有客服在线，下次发送消息会失败的问题
- 修复 加载图库可能出现超过 intent 传输限制的问题
- 优化 预览后返回选择界面，不重复加载图库数据
- 优化 国际化处理：提供英文语言资源

Version 3.5.3 *(2019-03-01)*
----------------------------
- 修复 部分新机器人消息未识别问题
- 修复 文件消息文件下载失败问题
- 修复 如果开发者设置了后台关闭美洽服务，从相机发送消息会失败的问题
- 优化 Android 8.0 以后系统调用关闭美洽服务，直接关闭 MeiqiaService

Version 3.5.2 *(2018-12-07)*
----------------------------
- 新增 消息支持混合消息类型
- 优化 未读消息支持工单消息

Version 3.5.1 *(2018-11-12)*
----------------------------
- 优化 提高海外用户连接访问的稳定性
- 优化 创建工单的时候与上一个对话关联
- 修复 询前表单可能出现在子线程更新 UI 的问题

Version 3.5.0 *(2018-09-07)*
----------------------------
- 优化 IntentBuilder 增加 updateClientInfo 方法
- 优化 关闭对话界面后，取消所有请网络求

Version 3.4.9 *(2018-08-21)*
----------------------------
- 新增 刷新推送接口

Version 3.4.8 *(2018-07-06)*
----------------------------
- 优化 企业名片名字为空的时候显示默认名字
- 优化 内部逻辑优化
- 修复 部分机器人消息不显示富文本内容问题

Version 3.4.7 *(2018-01-08)*
----------------------------
- 修复 调用顾客更新接口上传头像地址，无法显示头像问题
- 修复 显示富文本消息时可能出现的内存泄露的问题
- 优化 时间转换处理

Version 3.4.6 *(2017-09-01)*
----------------------------
- 优化 处理 Android 6.0 及以上系统的 Camera 权限问题
- 优化 兼容 Android 7.0 文件打开方式
- 优化 允许开发者设置自定义 ImageLoader
- 优化 将 SDK 里面的资源改为私有资源

Version 3.4.5 *(2017-08-11)*
----------------------------
- 修复 按下标题栏返回按钮关闭对话界面时，键盘可能不收回的情况
- 修复 图片加载的时候因为生命周期问题造成的崩溃问题
- 修复 保存图片的时候，如果 Activity 销毁，造成的空指针错误
- 优化 最大发送图片总数改为 3

Version 3.4.4 *(2017-07-14)*
----------------------------
- 优化 询前表单，如果所有选项都是「回头客不用填」，则直接跳过
- 优化 Socket 没有连上的时候提示用户，并且不允许发消息
- 新增 支持 无消息访客过滤 功能
- 修复 加载验证码的时候可能出现报错问题
- 修复 SDK留言界面中没有姓名字段

Version 3.4.3 *(2017-06-02)*
----------------------------
- 优化 支持显示 有关联消息的富文本机器人消息
- 新增 是否压缩图片的接口

Version 3.4.2 *(2017-04-20)*
----------------------------
- 优化 支持 Android 7.0 拍照
- 修复 通过 customizedId 获取未读消息不准问题
- 修复 录音的时候，可能出现 Resources.NotFoundException 异常
- 修复 富文本显示的时候末尾会换行问题

Version 3.4.1 *(2017-03-28)*
----------------------------
- 修复 工单微信字段改为 weixin
- 修复 可能会出现 socket 连两次的问题
- 优化 去掉默认打印的 log 输出
- 优化 捕获一些特殊异常

Version 3.4.0 *(2016-12-29)*
----------------------------
- 优化 替换掉以前的 WebSocket 库，提高连接稳定性

Version 3.3.7、3.3.8、3.3.9*(2016-12-05)*
----------------------------
- 修复 在 socket 断掉的情况下, 对话结束后, 发送消息会失败的问题
- 优化 SDK 中，获取未读消息接口, 时间以聊天界面, 收到的最后一条消息时间为准

Version 3.3.6 *(2016-11-18)*
----------------------------
- 修复 某些情况, 头像没有裁剪成圆形
- 优化 获取未读消息的时候, 如果当前用户没有上过线, 则返回未读消息为 0

Version 3.3.5 *(2016-10-31)*
----------------------------
- 修复 多企业绑定自定义 id 发消息不成功的问题

Version 3.3.4 *(2016-10-21)*
----------------------------
- 优化 网络不稳定的情况下,提高消息的可靠性
- 优化 工单界面,每次提交都新建工单
- 修复 改变标题栏文字颜色会导致返回图标颜色跟着改变的问题
- 修复 客服信息没有签名的问题
- 新增 工单分类选择
- 新增 对话结束 广播

Version 3.3.2、3.3.3 *(2016-10-01)*
----------------------------
- 优化 可以通过多个 appKey 初始化

Version 3.3.1 *(2016-09-09)*
----------------------------
- 优化 机器人图文消息用气泡的方式渲染
- 修复 顾客消息可能重复的问题
- 修复 留言的时候给机器人消息评价,会导致异常的问题

Version 3.3.0 *(2016-08-30)*
----------------------------
- 新增 机器人图文消息
- 新增 机器人关联问题

Version 3.2.9 *(2016-08-19)*
----------------------------
- 新增 支持工单接口

Version 3.2.8 *(2016-08-15)*
----------------------------
- 新增 支持询前表单
- 优化 没有设置顾客头像的时候不加载顾客头像
- 优化 未读消息过滤顾客的消息

Version 3.2.7 *(2016-07-27)*
----------------------------
- 新增 根据工作台配置的机器人回答未匹配次数，显示转人工的提示消息

Version 3.2.6 *(2016-07-22)*
----------------------------
- 新增 新增机器人反馈后的气泡显示

Version 3.2.5 *(2016-07-18)*
----------------------------
- 新增 MQManager 新增更新顾客信息接口 updateClientInfo
- 新增 MQIntentBuilder 新增预发送消息接口 setPreSendTextMessage、setPreSendImageMessage
- 新增 MQConfig 新增配置是否显示客户头像 isShowClientAvatar
- 新增 MQConfig 新增 MQConversationActivity 生命周期的回调接口 setActivityLifecycleCallback
- 新增 取消 gradle 依赖 PhotoView，依赖 PhotoView 源码的方式支持查看长图
- 修复 修复手机里没有图片时应用崩溃问题
- 修复 修复把非图片文件的后缀名改成图片文件后缀名时发送图片崩溃

Version 3.2.4 *(2016-07-05)*
----------------------------
- 新增 支持图文消息
- 修复 分配到机器人无法发送图片
- 优化 优化初始化接口,减少初始化参数
- 优化 图片加载库

Version 3.2.3 *(2016-06-21)*
----------------------------
- 新增 排队功能
- 修复 大图下载 ANR

Version 3.2.2 *(2016-06-06)*
----------------------------
- 修复 修复机器人客服菜单消息显示错乱

Version 3.2.1 *(2016-06-05)*
----------------------------
- 新增 美洽 SDK 错误日志收集
- 优化 兼容新版机器人客服消息
- 修复 修复 MQConversationActivity 内存泄漏  fix #91

Version 3.2.0 *(2016-05-28)*
----------------------------
- 新增 机器人客服
- 新增 留言表单
- 优化 okhttp2 升级到 okhttp3
- 优化 聊天界面图片加载
- 修复 拍照导致 Activity 被回收造成的空指针问题

Version 3.1.8 *(2016-05-16)*
----------------------------
- 修复 新建顾客没有第一次对话没有设备信息的问题

Version 3.1.7 *(2016-05-13)*
----------------------------
- 优化 更改顾客被拉黑时候的文案
- 优化 Android6.0 权限处理: 如果跳转界面之前没有获取权限,界面内需要权限时会再次申请
- 优化 MQIntentBuilder 如果 context 不是 Activity 的实例,自动添加 FLAG_ACTIVITY_NEW_TASK 的 FLAG
- 优化 当 App 退到后台,默认关闭美洽服务,节省电量: api >= 14 有效
- 新增 是否显示评价按钮开关
- 新增 监听 App 前后台生命周期: api >= 14 有效
- 修复 如果没有外部储存卡,拍照可能空指针问题

Version 3.1.6 *(2016-04-26)*
----------------------------
- 新增「黑名单」功能
- 新增「文件传输」功能
- 新增 切换当前顾客接口
- 修复 上传顾客信息失败后不会重新上传问题
- 优化代码，提高代码健壮性

Version 3.1.5 *(2016-03-31)*
----------------------------
- 初始化美洽 SDK 由以前的 MQManager.init(context, appKey, onInitCallBack)改为MQConfig.init(context, appKey, imageLoader, onInitCallBack)
- 优化图片加载库的使用，目前支持 glide、picasso、universalimageloader
- 修复直接给 AndroidManifest.xml 的 application 节点的 label 属性指定字符串时，保存图片出现空指针异常
- 修复特殊情况下断网时出现空指针异常

Version 3.1.4 *(2016-03-23)*
----------------------------
- 增加获取未读消息接口
- 增加自定义图片选择器
- 增加自定义聊天界面
- 增加 MQIntentBuilder 来构建打开 MQConversationActivity 的 Intent
- 优化自定义键盘切换速度
- 优化上线成功后设置顾客信息
- 修复指定分配后进入留言，发送留言失败
- 修复部分机型时间转换误差

Version 3.1.3 *(2016-03-09)*
----------------------------
- 修复部分手机时间戳不准问题
- 修复结束对话后，有几率收不到消息问题
- 修复指定分配无效问题
- 优化声音提醒

Version 3.1.2 *(2016-03-01)*
----------------------------

- 调整图片浏览

Version 3.1.1 *(2016-02-29)*
----------------------------

- 增加显示客服留言功能
- 优化图片浏览
- 修复从文件选择图片发送崩溃问题

Version 3.1.0 *(2016-02-03)*
----------------------------

- 新版聊天界面
- 新增评价功能

Version 3.0.9 *(2016-01-20)*
----------------------------

- 修复断网后，可能出现消息重复问题
- 修复多线程操作数据库造成的异常

Version 3.0.8 *(2016-01-18)*
----------------------------

- 移除在美洽 SDK 中处理 Android 6.0 的动态权限问题

Version 3.0.7 *(2016-01-18)*
----------------------------

- 修复断网重连后，收不到断网期间客服发送消息的问题
- 修复失败重发时，如果连续点击重发按钮导致连续发送消息的问题
- 修复失败重发后，数据库状态更新失败的问题
- 新增：增加删除消息接口
- 新增：一些简单的自定义UI接口

Version 3.0.6 *(2016-01-08)*
----------------------------

- 指定分配接口：增加设置分配规则
- 更改接口名：openMeiQiaRemotePushService -> closeMeiQiaService
- 更改接口名：closeMeiQiaRemotePushService -> openMeiQiaRemotePushService
